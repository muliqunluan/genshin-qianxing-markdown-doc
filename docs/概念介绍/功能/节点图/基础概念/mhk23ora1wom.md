# mhk23ora1wom

## 一、节点的定义

### 1.节点是什么在节点图中，节点是最原子化的基础功能单元每个节点都描述了一种特定的游戏逻辑功能例如：播放特效加法运算循环执行

### 2.节点的构成一个典型的节点如下图所示

#### (1)节点名用于描述节点的功能，非复合节点不可修改

#### (2)逻辑引脚用于连接节点图的执行流，描述了节点的执行顺序分为逻辑入引脚和逻辑出引脚逻辑入引脚可以连接其他节点的逻辑出引脚，节点图会顺着逻辑引脚间的执行流连线执行各个节点。逻辑入引脚可以认为是这个节点的“入口”逻辑出引脚可以连接其他节点的逻辑入引脚，用于表明当前节点执行完成后下一个执行的节点。逻辑出引脚可以认为是这个节点的“出口”

#### (3)参数引脚分为入参引脚和出参引脚入参引脚描述了该节点执行需要的参数，可以通过直接填值和连线输入的方式将参数值传入出参引脚描述了该节点执行完成后返回的参数，可以将其连接到其他节点的入参引脚实现节点间的参数传递以上图【加法运算】节点为例，该节点有两个入参引脚和一个出参引脚两个入参引脚分别对应了二元加法运算的两个加数，出参引脚对应了加法的运算结果如上所述，入参可以通过直接填值指定参数值，以下图为例，在运行时，该节点的出参值为（1+2=）3入参同样可以用连线的方式传入参数值以下图为例，右侧的加法运算的两个入参分别为3（2+1，上方加法运算的出参）和11（5+6，下方加法运算节点的出参）因此右侧加法运算节点的出参值为（11+3=）

### 143.节点的类型在节点图中，有以下五类节点节点类型示例样式功能执行节点逻辑引脚：包含一个逻辑入引脚和一个逻辑出引脚参数引脚：有若干入参引脚和若干出参引脚每个执行节点都对应一个特定的功能，当执行流运行到该节点时，会执行这个节点并产生一些实际影响游戏运行的效果，例如：播放特效、打出攻击、修改自定义变量等节点图会沿着事件以及执行节点之间的执行流连线执行事件节点逻辑引脚：只有一个逻辑出引脚，没有逻辑入引脚参数引脚：只有若干出参引脚，没有入参引脚事件节点描述了游戏中发生的一些事件，当这些事件发生时，会触发这个节点并沿着连线运行之后的执行流。事件节点是服务端节点图执行流的起始节点。每个可正常运行的执行流都一定由一个事件节点开始。对于绝大多数事件来说，它们仅在节点图所挂载的实体发生特定事件时触发。以左侧的【选项卡选中时】事件为例，它会在自身上的选项卡组件里配置的选项卡被选中时触发流程控制节点逻辑引脚：可能有多个逻辑入和逻辑出引脚参数引脚：可能有多个入参和出参引脚流程控制节点的数量较少，主要包括了一些会影响执行流流程的节点。它们都会包括多个逻辑出引脚，根据输入值的不同，后续会执行不同的逻辑流分支典型的例子就是左侧的双分支节点。该节点接受一个布尔值类型的参数。当该参数为【是】时，会沿着【是】对应的执行流向后执行；反之为【否】时，会沿着【否】对应的执行流向后执行运算节点逻辑引脚：无逻辑引脚参数引脚：一定有入参和出参引脚运算节点是一系列描述了【运算】行为的节点，例如：加法运算、大小比较等因此这类节点一定会有入参（运算的输入值）和出参（运算的结果值）运算节点没有逻辑引脚，因此仅可在运算流中使用查询节点逻辑引脚：无逻辑引脚参数引脚：可能有入参，一定有出参查询节点是一系列描述了【查询】行为的节点，例如：查询实体类型、查询当前界面控件组布局等这类节点一定会有一个出参作为查询的结果查询节点没有逻辑引脚，因此仅可在运算流中使用

## 二、节点之间的连接

### 1.节点之间如何连接节点图通过节点之间的【连线】将各个节点的功能串联起来以组织游戏逻辑连线的基础规则是不论是逻辑引脚还是参数引脚，都是出引脚连接入引脚、入引脚连接出引脚逻辑引脚连接逻辑引脚，形成的连线为执行流连线；参数引脚连接参数引脚，形成的连线为运算流连线

### 2.节点图连线

#### (1)执行流连线下图中高亮的部分即是【执行流连线】执行流连线连接了两个带有逻辑引脚的节点（例如：执行节点、事件节点、流程控制节点），并从前一个节点的逻辑出引脚连接至后一个节点的逻辑入引脚在运行时，执行流会顺着执行流连线的顺序，从事件节点的逻辑出引脚开始，一个节点一个节点按次序向后执行以上图为例，这些执行流节点的执行顺序为命中检测触发时（事件）——播放特效（执行）——双分支（流程控制）——发起攻击或销毁实体（执行）（取决于双分支节点的条件参数为【是】或【否】）执行流连线支持一对多和多对一连线执行流连线一对多指的是一个逻辑出引脚连接多个逻辑入引脚一对多的执行流连接仍然是按顺序顺次执行的（将鼠标悬停在一对多的引脚上时，可以在连线上看到执行顺序）需要注意的一对多连线的执行是按照深度优先进行执行的，即会将当前所在的执行流执行到末尾后，再执行下一个分支上的执行流以下图为例，在播放特效节点后，会先执行发起攻击——设置自定义变量，再执行销毁实体上图与下图的连接方式是等价的执行流连线多对一指的是多个逻辑出引脚连接一个逻辑入引脚这种情况下的执行流程与基础规则一致（按照逻辑出——逻辑入——逻辑出……的顺序向后执行）以下图为例，在执行发起攻击和销毁实体节点后，都会执行一次设置自定义变量节点上图与下图的连接方式是等价的需注意的是，这种连线方式可能引入一些难以发现的风险：虽然执行节点在节点图内只放置了一个，但仍会被运行多次。可以通过查看执行流实际运行的情况

#### (2)运算流连线下图中高亮的部分即是【运算流连线】运算流连线连接了两个带有参数引脚的节点，并从前一个节点的出参引脚连接至下一个节点的入参引脚运算流连线表明了参数的传递过程。运行时，会将前一个节点的出参传入下一个节点的入参进行计算或执行运算流连线仅支持一对多连接运算流一对多连线上图中就存在一个典型的运算流一对多连线（将鼠标悬停在引脚上可以高亮显示连线），如下图所示一对多连线说明同一个出参值同时传入了多个入参引脚进行计算。以下图为例，【事件源实体】的出参值同时传入了【播放特效】节点的【目标实体】入参以及【销毁实体】的【目标实体】入参，即这两个节点传入的是相同的值

### 3.其他连线规则

#### (1)不可成环以及特例节点图中，不论是执行流还是运算流，均不允许出现环状的连线（对于执行流来说多数情况会导致死循环，对于运算流来说会导致循环求值）如下图连线就是非法的连线方式这个规则存在一个特例，即【跳出循环】节点，具体功能说明见：-循环-跳出循环

#### (2)类型匹配节点图是一种强类型的脚本语言，即运行时，节点图中的所有参数都是以确定的数据类型进行传输和运行的因此只有类型完全相同的两个参数引脚才能直接连线如下图所示，【选项卡序号】和【额外碰撞序号】都为【整数】类型，因此可以连线而如下图，尝试将【选项卡序号】与【是否激活】连线时，会提示无法连接，因为【选项卡序号】是【整数】类型，而【是否激活】是【布尔值】类型

## 三、节点图与逻辑子图使用连线将各个节点连接在

一起，就形成了一张节点图。每张节点图都实现了一些特定的自定义逻辑 其中以事件节点出发，以及之后所有执行流连线串联起来的结构称为一个逻辑子图。每张节点图内可以包含多个逻辑子图下图即包含了两个逻辑子图需要注意的是，不允许出现跨逻辑子图的运算流连线。如下图所示由于运算流是跟随执行流进行求值的，当运算流入参连接的出参引脚位于其他执行流中时，会取出前一次执行时该运算流节点出参的值，这通常来说都会导致错误的结果

## 四、节点图的运行流程

### 1.节点图的起点

#### (1)服务端节点图服务端节点图均是事件驱动的，即服务端节点图执行流的起点一定是事件节点。当该事件节点触发时，会向后顺着执行流连线向后执行到最后一个执行节点，如下图红色箭头所示

#### (2)技能节点图技能节点图不是事件驱动的，而是有一个固定的节点图开始节点。技能节点图会从该节点开始向后顺次执行到最后一个节点

#### (3)本地过滤器节点图本地过滤器节点图只有运算流。因此该节点图没有起点，只有一个节点图结束节点作为节点图的出口。按照运算流的求值顺序，计算出最终的输出结果

### 2.执行流节点图会按照节点的逻辑引脚连接顺序，从前向后顺次执行各个节点有以下几个要点需要注意：所有节点图的执行流可以认为是在同一帧顺次执行的（在不考虑性能问题导致执行流延迟的情况下），且根据执行流的节点顺序有着固定的时序关系节点执行可能会失败（例如：尝试设置一个不存在的自定义变量的值），但节点执行失败不会影响执行流的执行，会继续正常执行下一个节点

### 3.运算流节点图的运算流是依赖执行流的调用来运行的，因此最终没有连接在执行流节点入参的运算流是不会生效的具体来说，当执行流执行到特定的执行节点时，如果该节点的入参存在通过参数连线进行传值，那么会沿着运算流连线反向溯源到最远的运算流节点，然后延运算流顺序从前向后计算，直到算出该入参值以下图为例，当执行到【设置节点图变量】时，发现【变量值】入参是通过运算流传参的，因此会沿着图中所示的红色箭头反向找到最远的运算流节点（即加法运算和较大值节点）然后再正向沿着运算流的连接顺序（从入参到出参再到下个节点的入参……）向后顺序执行各个运算节点，最终将值输出到执行流节点的入参另外，需要注意的是，上述溯源+计算的过程是以执行流节点为单位进行。即对于单个执行流节点，入参相关的运算流只会执行一次，但对于两个执行流节点则会重复执行一次以下图为例节点1中【变量名】和【变量值】这两个入参共用了部分运算流，但整个运算流仅会执行一遍（以图示顺序）但对于节点2，【变量值】入参与节点1的【变量值】入参共用了同一个运算流，但因为它们属于两个执行流节点，因此整个运算流会重新执行并计算一遍上述规则对于多数情况来说并不会影响使用，但在使用随机数时该特性会较为明显如下图所示。节点1的【变量名】和【变量值】这两个入参公用了同一个【获取随机整数】节点，但【获取随机整数】只会执行一次，因此这两个入参获取的随机数是相同的而对于节点2的【变量值】，由于【获取随机整数】会重新执行一次，因此会获得不同的随机数

## 五、节点图中的数据类型

### 1.基础数据类型以下为节点图中的基础数据类型数据类型功能说明默认值边界实体代表了一个运行时的实体0，无实际意义，指向了一个不存在的实体无GUID实体在场景中布设时的GUID。对于动态创建的实体来说 GUID = 00无整数32位带符号整型数，取值范围为-2147483648~21474836470超出范围会自动上/下溢出，即2147483648会自动变为-2147483648布尔值布尔型。只有【是】和【否】两个取值否无浮点数单精度浮点数，取值范围约为±

### 1.5 x 10^−45 至 ±

### 3.4 x 10^380与多数编程语言不同，我们并不使用溢出值/无效值（一般表示为Inf或NaN）来处理浮点的溢出。当发生溢出时，将值修正为0字符串字符串类型，用于表示文本数据""（空串）最长不能超过40个英文字符（约13个中文字符）三维向量三维向量类型向量的每一个分量都是一个浮点数(0,0,0)单个分量发生溢出时，按照浮点数的溢出规则处理元件ID元件的ID，对应一个特定的元件0，无实际意义，指向了一个不存在的元件无配置ID通用配置的ID，例如：单位状态的ID、职业的ID等0，无实际意义，指向了一个不存在的配置无

### 2.列表数据类型上述每一个基础类型都会有一个对应的列表类型。数据类型实体列表GUID列表整数列表布尔值列表浮点数列表字符串列表三维向量列表元件ID列表配置ID列表列表类型的数据内存储了一组同类型的数据，可以通过列表类型对一组数据更方便的进行管理以【整数列表】为例，一个典型的【整数列表】存储了一组整数，例如{1，3，5，7，9}可以对其进行列表操作，例如：使用【对列表插入值】将一个整数插入列表，如下图所示。执行后该列表会变为{1，3，5，4，7，9}此外列表的数据类型有以下的特点：列表的序号从0开始计数。即使用【获取列表对应值】节点时，插入序号输入0对应了列表的第一个元素列表在节点图中使用的是【引用传值】的形式进行参数传递，见

### 3.基础数据类型之间的转换规则通过【数据类型转换】，可以在部分数据类型之间进行转换源类型目标类型转换逻辑示例整数布尔值0转为否，非0转为是输入：0 输出：否输入：5 输出：是浮点数整数转浮点数输入：1 输出：

### 1.0输入：-2 输出：-

### 2.0输入：0 输出：

### 0.0字符串整数转字符串输入：1 输出：“1”输入：15 输出： “15”实体字符串输出实体的运行时id输入：某个实体输出："1001"GUID字符串输出GUID对应的字符串输入：某个实体输出：“100001”布尔值整数否转为0，是转为1输入：否 输出：0输入：是 输出：1字符串返回”是“和”否“输入：否 输出：“否”输入：是 输出：”是“浮点数整数截尾转为整数，与取整节点的截尾功能相同输入：

### 2.5 输出：2输入：-

### 1.31 输出：-1输入：

### 0.0 输出：0字符串输出浮点数对应的字符串，至多保留6位有效数字输入：

### 2.5 输出："

### 2.5"输入：-

### 1.317524 输出：“-

### 1.31752”三维向量字符串返回"(分量1,分量2,分量3)"格式的字符串。每个分量保留1位小数输入：（

### 1.05，

### 2.3，3）输出：“（

### 1.0，

### 2.3，

### 3.0）”阵营字符串返回阵营的id转为的字符串输入：（某个实体上的阵营）输出：“2”

### 4.节点图中的非法值为了确保执行流可以正确向后执行，节点图不存在非法值的概念。当节点执行失败（例如：除法节点的除数为0）时，出参为该类型的默认值（例如：对于整数型除法来说，出参为0）
